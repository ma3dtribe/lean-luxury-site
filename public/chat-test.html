<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Ma3dTribe Chat + GIPHY</title>

  <style>
    body{margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial;background:#0b0f14;color:#e9eef6;}
    .wrap{max-width:860px;margin:0 auto;padding:16px;}
    .card{background:#111826;border:1px solid rgba(255,255,255,.08);border-radius:14px;overflow:hidden;}
    .header{padding:14px 16px;border-bottom:1px solid rgba(255,255,255,.08);display:flex;gap:10px;align-items:center;}
    .dot{width:10px;height:10px;border-radius:50%;background:#22c55e;box-shadow:0 0 18px rgba(34,197,94,.35);}
    .title{font-weight:700;}
    .status{margin-left:10px;font-size:12px;opacity:.8;}
    #chatMessages{height:58vh;overflow:auto;padding:14px 16px;display:flex;flex-direction:column;gap:10px;}
    .msg{max-width:78%;padding:10px 12px;border-radius:14px;border:1px solid rgba(255,255,255,.10);}
    .me{margin-left:auto;background:#1a2a42;}
    .meta{font-size:12px;opacity:.7;margin-bottom:4px;}
    .composer{padding:12px;border-top:1px solid rgba(255,255,255,.08);display:flex;gap:10px;}
    #messageInput{flex:1;padding:12px;border-radius:12px;border:1px solid rgba(255,255,255,.14);background:#0e1623;color:#e9eef6;}
    .btn{padding:10px 12px;border-radius:12px;border:1px solid rgba(255,255,255,.14);background:#0e1623;color:#e9eef6;cursor:pointer;}
    .btnPrimary{background:#2563eb;border-color:#2563eb;}
  </style>
</head>

<body>
  <div class="wrap">
    <div class="card">
      <div class="header">
        <div class="dot"></div>
        <div class="title">Ma3dTribe Chat (Test)</div>
        <div id="dbStatus" class="status">DB: loading…</div>
      </div>

      <div id="chatMessages">
        <div class="msg">
          <div class="meta">System</div>
          Welcome. Type a message.
        </div>
      </div>

      <div class="composer">
        <input id="messageInput" type="text" placeholder="Type your message…" />
        <button id="sendBtn" class="btn btnPrimary">Send</button>
      </div>
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2/dist/umd/supabase.js"></script>
  <script>
    const SUPABASE_URL = "https://tgqfplueqjhsywkcjaal.supabase.co";
    const SUPABASE_ANON_KEY = "sb_publishable_xzNaO0t5I2iCmv3LzYG9Ow_K8ZS9s0u";

    const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

    const dbStatus = document.getElementById("dbStatus");
    const chatMessages = document.getElementById("chatMessages");
    const messageInput = document.getElementById("messageInput");
    const sendBtn = document.getElementById("sendBtn");

    dbStatus.textContent = "DB: ready ✅";

    function addMessage(text) {
      const div = document.createElement("div");
      div.className = "msg me";
      div.innerHTML = `<div class="meta">You</div>${text}`;
      chatMessages.appendChild(div);
    }

    sendBtn.addEventListener("click", async () => {
      const text = messageInput.value.trim();
      if (!text) return;

      addMessage(text);
      messageInput.value = "";

      const { error } = await supabase.from("messages").insert({
        room: "ma3dtribe",
        username: "DW",
        kind: "text",
        context: text,
        source: "web"
      });

      if (error) {
        console.error(error);
        dbStatus.textContent = "DB: save failed ❌";
      } else {
        dbStatus.textContent = "DB: saved ✅";
      }
    });
  </script>
</body>
</html>
